{% load static %}
{% load custom_filters %}
{% load social_share %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1, user-scalable=no">
    <meta name="description" content="Explore a world of creativity, entertainment, and discovery.ChatðŸ“±,UploadðŸ˜Š,Download â¬‡,Share and Have FunðŸ˜‚ðŸ¤£!!"/>
    <meta name="description" content="Welcome to TrendWave, where you can dive into the latest trends and ride the waves of viral content. Explore a world of creativity, entertainment, and discovery as you scroll through our curated selection of trending topics. From viral challenges to the hottest memes, TrendWave keeps you in the loop with what's capturing the internet's attention right now.">
    {% load bootstrap5 %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Bree+Serif&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <title>TrendWave - Ride the Wave of Trends</title>
</head>
<body class="dark-theme">   
<div id="contentId">
{% include "base.html" %}
{% block content %}
<br>
<div id="one" class="carousel slide pt-2 d-block d-sm-none" data-bs-ride="carousel">
    <div class="carousel-indicators">
        {% for image in latest_images %}
        <button type="button" data-bs-target="#one" data-bs-slide-to="{{ forloop.counter0 }}"
         {% if forloop.first %} class="active bg-warning" {% endif %}></button>   
        {% endfor %}
    </div>
    <div class="carousel-inner pt-2 respnsive-iframe" height="200px" width="200px">
        {% for image in latest_images %}
        <div class="carousel-item{% if forloop.first %} active{% endif %}">
            {% if image.file.url|is_image %}
            <a href="{{ image.file.url}}" class="text-decoration-none img-fluid"><img src="{{ image.file.url }}" alt="" class="img-fluid" style="height: 400px; width: 100%;"></a>
            <div class="carousel-caption">
                <!--<h5>{{ image.caption }}</h5>-->
                <h1 class="text-danger">Trending</h1>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#one" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#one" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>
<br>
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar column for large screens -->
        <div class="col-md-3 d-none d-lg-block d-xl-block">
            <div class="sidebar border-3 sidebar-item" id="id_sidebar">
                <!-- Sidebar content -->
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a href="/" class="nav-link d-flex align-items-center">
                            <i class="material-icons me-2">&#xe88a;</i>
                            <button class="btn" id="sidebarId"><h5>Home</h5></button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'explore' %}" class="nav-link d-flex align-items-center">
                            <i class="material-icons me-2">&#xe87a;</i>
                            <button class="btn" id="sidebarId"><h5>Explore</h5></button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'following' %}" class="nav-link d-flex align-items-center">
                            <i class="material-icons me-2">&#xe7fe;</i>
                            <button class="btn" id="sidebarId"><h5>Following</h5></button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'about' %}" class="nav-link d-flex align-items-center">
                            <i class="material-icons">&#xe02f;</i><button class="btn" id="sidebarId"><h5>About</h5></button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'discover' %}" class="nav-link d-flex align-items-center">
                            <i class="material-icons me-2">&#xe89e;</i>
                            <button class="btn" id="sidebarId"><h5>Discover</h5></button>
                        </a>
                    </li>
                    <br>
                    <hr>
                    <li class="nav-item">
                        <div class="d-none d-lg-block d-xl-block">
                            {% if user.is_authenticated %}
                            <!-- User-specific content goes here -->
                            {% else %}
                            <a href="{% url 'signIn' %}" class="nav-link d-flex justify-content-center">
                                <button class="btn btn-outline-danger w-50">
                                    <h4>Log in</h4>
                                </button>
                            </a>
                            {% endif %}
                        </div>
                    </li>
                </ul>
                <footer>
                    {% if user.is_authenticated %}
                    <p style="color: blueviolet;">
                        Welcome back to TrendWave! Keep exploring trending topics, join viral challenges, and enjoy the hottest memes. Your journey through the best of the internet continues right <code>here.</code>
                    </p>
                    {% else %}
                    <p style="color: blueviolet;">
                        Join TrendWave! Explore creativity, entertainment, and trending topics. Stay in the loop with viral challenges and the hottest memes right <code>now.</code>
                    </p>
                    {% endif %}
                </footer>
                <!--<button class="text-center btn btn-info" id="inviteFriendBtn">
                    <h5>Invite Friend</h5>
                </button>-->
            </div>
        </div>
        <!-- Main content column -->
        <div class="col-lg-8">
            <div class="row justify-content-center">
                <div class="col-md-7">
                    <form action="" method='GET'>
                        {% csrf_token %}
                        <div class="row">
                            {% for x in img %}
                            <div id="file-{{ x.id }}" class="col-12 file-card">
                                <div class="card mb-3">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        {% if x.user.theprofile.profileimg %}
                                        <div class="user-profile">
                                            <div class="card-header d-flex align-items-center">
                                                <div class="user-profile me-2">
                                                    <a href="/profile/{{ x.user.username }}">
                                                        <img src="{{ x.user.theprofile.profileimg.url }}" class="rounded-circle" width="60px" height="60px"
                                                            alt="user_profile_pic">
                                                    </a>
                                                </div>
                                                <div>
                                                    <a href="/profile/{{ x.user.username }}" class="text-decoration-none user-name">
                                                        <h3 class="mb-0">@{{ x.user.username }}</h3>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <a href="{% url 'image_detail' x.id %}" class="text-decoration-none">
                                        {% if x.file.url|is_image %}
                                        <img src="{{ x.file.url }}" alt="" class="card-img-top img-fluid" style="height: 400px;">
                                        {% elif x.file.url|is_video %}
                                        <video class="card-img-top img-fluid" controls preload="metadata" aria-describedby="video-description">
                                            <source src="{{ x.file.url }}" type="video/mp4">
                                            <source src="{{ x.file.url }}" type="video/webm">
                                            <source src="{{ x.file.url }}" type="video/ogg">
                                            Your browser does not support the video tag.
                                            <track label="English" kind="captions" srclang="en" default>
                                            <track label="Spanish" kind="captions" srclang="es">
                                        </video>
                                        <!--<div id="video-description" class="sr-only">
                                            This is a description of the video content. Provide a brief summary of the video's key points and content here.
                                        </div>-->
                                        {% endif %}
                                    </a>
                                    <div class="card-footer align-items-center">
                                        <div class="d-flex justify-content-between align-items-center w-100">
                                            <div>
                                                <a href="{{ x.file.url }}" data-bs-toggle="modal" data-bs-target="#shareModal"
                                                    class="share-button text-decoration-none">
                                                    <i class="material-icons">&#xe80d;</i>
                                                </a>
                                                <div class="d-inline-flex align-items-center">
                                                    <a href="/like-image?x_id={{ x.id }}&next={{ request.path }}#file-{{ x.id }}"
                                                        class="text-decoration-none d-flex align-items-center like-button"
                                                        data-file-id="{{ x.id }}" data-likes="{{ x.likes }}">
                                                        <i
                                                            class="material-icons {% if like_filter == username %}liked{% else %}not-liked{% endif %}">favorite</i>
                                                        <span class="ms-1">{{ x.likes }}</span>
                                                    </a>
                                                </div>
                                                <a href="{{ x.file.url }}" download="{{ x.file.url }}" id="download">
                                                    <i class="material-icons">&#xe2c4;</i>
                                                </a>
                                            </div>
                                            <div class="float-start">
                                                <a href="{% url 'image_detail' x.id %}" class="btn btn-link p-0 comments">
                                                    <i class="material-icons" style="font-size:36px">comment</i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text" id="user_caption" >{{ x.caption }}</p>
                                        <small class="" id="posted-date">{{ x.date }}</small>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<br>
    <br>
    <div class="modal fade" id="shareModal">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="text-primary">Share to:</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    {% load static %}
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
                    {% post_to_facebook object_or_url '<i style="font-size:24px" class="fa">&#xf082;facebook</i>'%}&nbsp;
                    {% post_to_whatsapp object_or_url '<i style="font-size:24px" class="fa text-success">&#xf232;whatsapp</i>'%}&nbsp;
                    {% post_to_telegram 'Hey! Check out this meme ðŸ˜Š' object_or_url '<i style="font-size:24px" class="fa text-primary">&#xf2c6;telegram</i>' %}&nbsp;
                    {% post_to_twitter 'Hey! check out this meme ðŸ˜Š' object_or_url '<i style="font-size:24px" class="fa">&#xf081;twitter</i>' %}&nbsp;
                    {% send_email 'funny meme' 'Hey! check out this meme ðŸ˜Š' object_or_url '<i class="material-icons" id="mail" style="color: brown;">&#xe0be;</i>' %}                              
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <br>
{% endblock %}
{% include "footer.html" %}
{% include "user_base.html" %}
</div>
</body>
<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerE1) {
        return new bootstrap.Tooltip(tooltipTriggerE1)
    })

document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.like-button').forEach(function (element) {
        let fileId = element.getAttribute('data-file-id');
        let icon = element.querySelector('i.material-icons');
        let likeCountSpan = element.querySelector('span.ms-1');

        // Check local storage for like status
        if (localStorage.getItem(`liked_${fileId}`) === 'true') {
            icon.classList.add('liked');
            icon.classList.remove('not-liked');
        } else {
            icon.classList.add('not-liked');
            icon.classList.remove('liked');
        }

        element.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent the default action

            // Make AJAX request to like the image
            fetch(`/like-image?x_id=${fileId}&next=${encodeURIComponent(window.location.pathname)}`, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.authenticated === false) {
                        window.location.href = data.login_url;
                    } else {
                        if (data.liked) {
                            icon.classList.add('liked');
                            icon.classList.remove('not-liked');
                            localStorage.setItem(`liked_${fileId}`, 'true');
                        } else {
                            icon.classList.add('not-liked');
                            icon.classList.remove('liked');
                            localStorage.setItem(`liked_${fileId}`, 'false');
                        }
                        likeCountSpan.textContent = data.likes;
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    });
});
</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
    <!--form.action = `/delete_for_me/${postId}/`;-->
</html>